{"version":3,"sources":["components/Card.tsx","libs/web3.ts","libs/metamask.ts","pages/Expore.tsx"],"names":["Image","styled","img","Header","Card","whiteSpace","overflow","textOverflow","Meta","CardItem","Description","data","image","isForSale","price","name","description","owner","useAppDispatch","useContractJson","potatoMarketContract","NFTContract","style","height","width","src","Content","extra","contractEvent","getWeb3Provider","a","window","ethereum","Web3","getChainId","provider","eth","net","getId","getMetamask","request","method","accounts","getMetamaskAccount","console","log","chainChanged","callback","on","parseInt","accountChanged","Expore","nfts","useAppSelector","state","expore","dispatch","screenWidth","useScreenSize","maxWidth","useState","showSidebar","setShowSidebar","getNFTsData","useCallback","loadNFTs","then","setNFTs","useEffect","id","CustomGrid","Grid","handleShowSidebar","Pushable","borderRight","background","animation","direction","visible","inverted","borderRadius","Item","onClick","justifyContent","display","borderBottom","vertical","size","icon","placeholder","color","Pusher","pointing","secondary","active","padding","map","e","i","Column","mobile","tablet","largeScreen","computer"],"mappings":"0SAWMA,EAAQC,IAAOC,IAAV,qHAOLC,EAASF,YAAOG,IAAKD,OAAZF,CAAoB,CACjCI,WAAY,SACZC,SAAU,SACVC,aAAc,aAGVC,EAAOP,YAAOG,IAAKI,KAAZP,CAAkB,CAC7BI,WAAY,SACZC,SAAU,SACVC,aAAc,aAcHE,GAXOR,YAAOG,IAAKM,YAAZT,CAAyB,CAC3CI,WAAY,SACZC,SAAU,SACVC,aAAc,aAQQ,SAAC,GAA2C,IAAzCI,EAAwC,EAAxCA,KACjBC,GADyD,EAAlCC,UACoBF,EAA3CC,OAAOE,EAAoCH,EAApCG,MAAoBC,GAAgBJ,EAA7BK,YAA6BL,EAAhBI,MAAME,EAAUN,EAAVM,MAGzC,GADiBC,cAC6BC,eAA9C,EAAQC,qBAAR,EAA8BC,YA8B9B,OACE,eAAC,IAAD,CAAMC,MAAO,CAAEC,OAAQ,OAAQC,MAAO,QAAtC,UACE,cAACxB,EAAD,CAAOyB,IAAKb,IACZ,eAAC,IAAKc,QAAN,WACE,cAACvB,EAAD,UAASY,IACT,cAACP,EAAD,UACGS,OAML,cAAC,IAAKS,QAAN,CAAcC,OAAK,EAAnB,SACE,8BACE,cAAC,IAAD,CAAMZ,KAAK,aACVD,a,iKCvFCc,E,qDAAAA,K,WAAAA,M,KAIL,IAAMC,EAAe,uCAAG,8BAAAC,EAAA,yDACE,qBAApBC,OAAOC,SADW,yBAEND,OAAbC,EAFmB,EAEnBA,SAFmB,kBAGpB,IAAIC,IAAKD,IAHW,gCAKtB,MALsB,2CAAH,qDAQfE,EAAU,uCAAG,4BAAAJ,EAAA,sEACDD,IADC,cAClBM,EADkB,gCAEjBA,QAFiB,IAEjBA,OAFiB,EAEjBA,EAAUC,IAAIC,IAAIC,SAFD,2CAAH,qDCejBC,EAAW,uCAAG,gCAAAT,EAAA,yDACa,qBAApBC,OAAOC,SADA,yBAEKD,OAAbC,EAFQ,EAERA,SAFQ,SAGOA,EAASQ,QAAQ,CAAEC,OAAQ,wBAHlC,cAGVC,EAHU,yBAITA,GAJS,gCAMX,IANW,2CAAH,qDASJC,EAAkB,uCAAG,4BAAAb,EAAA,sEACTS,IADS,cAC1BG,EAD0B,gBAGVR,IAHU,cAKhB,OALgB,QAM9BU,QAAQC,IAAI,mBANkB,kBASzBH,GATyB,2CAAH,qDAYlBI,EAAe,SAACC,GACI,qBAApBhB,OAAOC,UACKD,OAAbC,SACCgB,GAAG,gBAAgB,SAACrC,GACvBoC,GAAUA,EAASE,SAAStC,EAAa,SAKtCuC,EAAiB,SAACH,GACE,qBAApBhB,OAAOC,UACKD,OAAbC,SACCgB,GAAG,mBAAmB,SAACN,GAC1BK,GAAUA,EAASL,Q,gUCwEdS,UA9HU,WACvB,IAAQC,EAASC,aAAe,SAACC,GAAD,OAAWA,EAAMC,UAAzCH,KACFI,EAAWtC,cACjB,EAA8CC,cAAtCC,EAAR,EAAQA,qBAAsBC,EAA9B,EAA8BA,YACxBoC,EAAcC,YAAc,CAAEC,SAAU,OAC9C,EAAsCC,oBAAkB,GAAxD,mBAAOC,EAAP,KAAoBC,EAApB,KAIMC,EAAcC,uBAAY,WAC1B5C,GAAwBC,GAC1B4C,YAAS7C,EAAsBC,GAAa6C,MAAK,SAACvD,GAChD6C,EAASW,YAAQxD,SAGpB,CAACS,EAAsBC,IAE1B+C,qBAAU,WACRzB,cAAqBuB,MAAK,SAACxB,GACrBA,GAAYA,EAAS,IACvBqB,SAGH,CAACA,IAEJjB,YAAY,uCAAC,WAAOuB,GAAP,SAAAvC,EAAA,sDACA,OAAPuC,GACFzB,QAAQC,IAAI,mBACZW,EAASW,YAAQ,MAEjBJ,IALS,2CAAD,uDASZ,IAAMO,EAAaC,IAEbC,EAAoB,WACxBV,GAAgBD,IAGlB,OACE,cAAC,WAAD,UACE,eAAC,IAAQY,SAAT,CAAkBnD,MAAO,CAAEC,OAAQ,uBAAnC,UACE,cAAC,IAAD,CACEC,MAAOqC,IAAgBJ,EAAc,OAAS,YAC9CnC,MAAO,CAAEoD,YAAa,wBAAyBC,WAAY,WAC3DC,UAAU,OACVC,UAAU,OACVC,SAAS,EALX,UAOIjB,GAAeJ,EAAc,cAAC,IAAD,CAAMsB,UAAQ,EAACzD,MAAO,CAAE0D,aAAc,KAAtC,SAC7B,cAAC,IAAKC,KAAN,CAAWC,QAASV,EAAmBlD,MAAO,CAAEE,MAAO,OAAQ2D,eAAgB,SAAUC,QAAS,OAAQC,aAAc,sBAAuB9D,OAAQ,QAAvJ,SACE,cAAC,IAAD,CAAMR,KAAK,eAGX,eAAC,IAAD,CAAMgE,UAAQ,EAACO,UAAQ,EAACC,KAAK,UAAUjE,MAAO,CAAE0D,aAAc,KAA9D,UACA,eAAC,IAAKC,KAAN,CACElE,KAAK,QAELmE,QAASV,EAHX,mBAME,cAAC,IAAD,CAAMzD,KAAK,kBAEb,cAAC,IAAKkE,KAAN,UACE,cAAC,IAAD,CAAOO,KAAK,SAASC,YAAY,gBAEnC,eAAC,IAAKR,KAAN,CACElE,KAAK,QADP,UAKE,cAAC,IAAD,CAAO2E,MAAM,OAAb,eALF,WASA,eAAC,IAAKT,KAAN,CACElE,KAAK,OADP,UAKE,cAAC,IAAD,iBALF,UASA,eAAC,IAAKkE,KAAN,CACElE,KAAK,UADP,UAKE,cAAC,IAAD,gBALF,kBAWN,eAAC,IAAQ4E,OAAT,WACE,eAAC,IAAD,CAAMC,UAAQ,EAACb,UAAQ,EAACc,WAAS,EAACN,KAAK,UAAUjE,MAAO,CAAE+D,aAAc,sBAAuBL,aAAc,KAA7G,UACE,cAAC,IAAKC,KAAN,CACE3D,MAAO,CAAE0D,aAAc,KACvBc,QAAQ,EAFV,mBAMA,cAAC,IAAKb,KAAN,CACE3D,MAAO,CAAE0D,aAAc,IAAKzD,OAAQ,QACpCuE,QAAQ,EAFV,yBAOF,qBAAKxE,MAAO,CAAEyE,QAAS,OAAvB,SACE,cAACzB,EAAD,CAAYhD,MAAO,CAAEE,MAAOqC,IAAgBJ,EAAc,sBAAwB,sBAAlF,SACGL,EAAK4C,KAAI,SAACC,EAAGC,GAAJ,OACR,cAAC,IAAKC,OAAN,CAAaC,OAAQ,EAAGC,OAAQ,EAAGC,YAAa,EAAGC,SAAU,EAA7D,SACE,cAAC,IAAD,CAAU5F,KAAMsF","file":"static/js/14.37fb5925.chunk.js","sourcesContent":["import { getEtherContract } from '../libs/ethereum'\r\nimport { PotatoMarketInstance } from '../../types/truffle-contracts'\r\nimport { ethers } from 'ethers'\r\nimport { INFTItem, setMyNFTs, setNFTs } from '../states/expore/reducer'\r\nimport { loadMyNFTs, loadNFTs } from '../services'\r\nimport { useAppDispatch } from '../states/hooks'\r\nimport { config } from '../config'\r\nimport { useContractJson } from '../hooks/contracts'\r\nimport { Card, Icon } from 'semantic-ui-react'\r\nimport styled from '@emotion/styled'\r\n\r\nconst Image = styled.img`\r\ndisplay: block;\r\nwidth: 100%;\r\nheight: 14em;\r\nborder-radius: inherit;\r\nobject-fit: cover;`\r\n\r\nconst Header = styled(Card.Header)({\r\n  whiteSpace: 'nowrap',\r\n  overflow: 'hidden',\r\n  textOverflow: 'ellipsis'\r\n})\r\n\r\nconst Meta = styled(Card.Meta)({\r\n  whiteSpace: 'nowrap',\r\n  overflow: 'hidden',\r\n  textOverflow: 'ellipsis'\r\n})\r\n\r\nconst Description = styled(Card.Description)({\r\n  whiteSpace: 'nowrap',\r\n  overflow: 'hidden',\r\n  textOverflow: 'ellipsis'\r\n})\r\n\r\ninterface ICardItem {\r\n  data: INFTItem\r\n  isForSale?: boolean\r\n}\r\n\r\nexport const CardItem = ({ data, isForSale = true }: ICardItem) => {\r\n  const { image, price, description, name, owner } = data\r\n\r\n  const dispatch = useAppDispatch()\r\n  const { potatoMarketContract, NFTContract } = useContractJson()\r\n\r\n  const handleClick = async () => {\r\n    if (potatoMarketContract && NFTContract) {\r\n      const marketContract = (await getEtherContract(\r\n        potatoMarketContract,\r\n        config.marketContractAddress\r\n      )) as unknown as PotatoMarketInstance\r\n      // const ntfContract = (await getEtherContract(NFT)) as unknown as NFTInstance\r\n      const price = ethers.utils.formatUnits(data.price, 'wei')\r\n\r\n      const createMarketSale = await marketContract.createMarketSale(config.nftContractAddress, data.itemId, {\r\n        value: price.toString(),\r\n        gasLimit: '6721975',\r\n        gasPrice: '20000000000'\r\n      })\r\n      await (createMarketSale as any).wait()\r\n      if (isForSale) {\r\n        loadNFTs(potatoMarketContract, NFTContract).then((data) => {\r\n          dispatch(setNFTs(data))\r\n        })\r\n        loadMyNFTs(potatoMarketContract, NFTContract).then((data) => {\r\n          dispatch(setMyNFTs(data))\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  return (\r\n    <Card style={{ height: \"23em\", width: '100%' }}>\r\n      <Image src={image} />\r\n      <Card.Content>\r\n        <Header>{name}</Header>\r\n        <Meta >\r\n          {owner}\r\n        </Meta>\r\n        {/* <Description>\r\n          {description}\r\n        </Description> */}\r\n      </Card.Content>\r\n      <Card.Content extra>\r\n        <a>\r\n          <Icon name='ethereum' />\r\n          {price}\r\n        </a>\r\n      </Card.Content>\r\n    </Card >\r\n  )\r\n}\r\n","import { Contract, ContractSendMethod, DeployOptions, EventData } from 'web3-eth-contract'\nimport Web3 from 'web3'\n\nexport enum contractEvent {\n  Log = 'Log'\n}\n\nexport const getWeb3Provider = async (): Promise<Web3 | null> => {\n  if (typeof window.ethereum !== 'undefined') {\n    const { ethereum } = window\n    return new Web3(ethereum as any)\n  }\n  return null\n}\n\nexport const getChainId = async (): Promise<number | undefined> => {\n  const provider = await getWeb3Provider()\n  return provider?.eth.net.getId()\n}\n\nexport const getWeb3Contract = async (\n  contractDefinition: Record<string, any>,\n  address: string\n): Promise<Contract | null> => {\n  const provider = await getWeb3Provider()\n  const networkId = await getChainId()\n  console.log({ networkId })\n\n  if (provider && networkId) {\n    const contract = new provider.eth.Contract(contractDefinition['abi'], address)\n    return contract\n  }\n  return null\n}\n\nexport const getContractEvent = (contract: Contract, event: contractEvent): Promise<EventData[]> => {\n  const options = {\n    filter: {\n      value: []\n    },\n    fromBlock: 0, //Number || \"earliest\" || \"pending\" || \"latest\"\n    toBlock: 'latest'\n  }\n  return contract.getPastEvents(event, options)\n}\n\nexport const deployContract = (contract: Contract): ContractSendMethod => {\n  const options: DeployOptions = {\n    data: '',\n    arguments: []\n  }\n  return contract.deploy(options)\n}\n","import { getChainId } from './web3'\n\ndeclare global {\n  interface Window {\n    ethereum?: EthereumProvider\n  }\n}\n\ninterface RequestArguments {\n  method: 'eth_requestAccounts' | 'chainChanged' | 'accountsChanged'\n  params?: unknown[] | Record<string, unknown>\n}\n\ninterface ConnectInfo {\n  chainId: string\n}\n\ntype eventMap = {\n  chainChanged: string\n  connect: ConnectInfo\n  accountsChanged: string[]\n}\n\ntype eventResult<T extends keyof eventMap> = T extends string ? string | string[] : ConnectInfo\n\nexport interface EthereumProvider {\n  request(args: RequestArguments): Promise<string[]>\n  on: <T extends keyof eventMap>(event: keyof eventMap, handler: (data: eventResult<T>) => void) => void\n}\n\nconst getMetamask = async (): Promise<string[]> => {\n  if (typeof window.ethereum !== 'undefined') {\n    const { ethereum } = window\n    const accounts = await ethereum.request({ method: 'eth_requestAccounts' })\n    return accounts\n  }\n  return []\n}\n\nexport const getMetamaskAccount = async () => {\n  const accounts = await getMetamask()\n\n  const chainId = await getChainId()\n\n  if (chainId !== 1337) {\n    console.log('incurrect chain')\n  }\n\n  return accounts\n}\n\nexport const chainChanged = (callback?: (chainId: number) => void): void => {\n  if (typeof window.ethereum !== 'undefined') {\n    const { ethereum } = window\n    ethereum.on('chainChanged', (data) => {\n      if (callback) callback(parseInt(data as any, 16))\n    })\n  }\n}\n\nexport const accountChanged = (callback?: (ac: string[]) => void): void => {\n  if (typeof window.ethereum !== 'undefined') {\n    const { ethereum } = window\n    ethereum.on('accountsChanged', (accounts) => {\n      if (callback) callback(accounts as any)\n    })\n  }\n}\n","import { Fragment, useCallback, useEffect, useState } from 'react'\r\nimport { Button, Divider, Grid, Icon, Input, Label, Menu, Segment, Sidebar } from 'semantic-ui-react'\r\nimport { CardItem } from '../components/Card'\r\nimport { useContractJson } from '../hooks/contracts'\r\nimport { useScreenSize } from '../hooks/screenSize'\r\nimport { chainChanged, getMetamaskAccount } from '../libs/metamask'\r\nimport { loadNFTs } from '../services'\r\nimport { setNFTs } from '../states/expore/reducer'\r\nimport { useAppDispatch, useAppSelector } from '../states/hooks'\r\n\r\nconst Expore: React.FC = () => {\r\n  const { nfts } = useAppSelector((state) => state.expore)\r\n  const dispatch = useAppDispatch()\r\n  const { potatoMarketContract, NFTContract } = useContractJson()\r\n  const screenWidth = useScreenSize({ maxWidth: 1500 })\r\n  const [showSidebar, setShowSidebar] = useState<boolean>(true)\r\n\r\n\r\n\r\n  const getNFTsData = useCallback(() => {\r\n    if (potatoMarketContract && NFTContract) {\r\n      loadNFTs(potatoMarketContract, NFTContract).then((data) => {\r\n        dispatch(setNFTs(data))\r\n      })\r\n    }\r\n  }, [potatoMarketContract, NFTContract])\r\n\r\n  useEffect(() => {\r\n    getMetamaskAccount().then((accounts) => {\r\n      if (accounts && accounts[0]) {\r\n        getNFTsData()\r\n      }\r\n    })\r\n  }, [getNFTsData])\r\n\r\n  chainChanged(async (id) => {\r\n    if (id !== 1337) {\r\n      console.log('incurrect chain')\r\n      dispatch(setNFTs([]))\r\n    } else {\r\n      getNFTsData()\r\n    }\r\n  })\r\n\r\n  const CustomGrid = Grid as any\r\n\r\n  const handleShowSidebar = () => {\r\n    setShowSidebar(!showSidebar)\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <Sidebar.Pushable style={{ height: 'calc(100vh - 108px)' }} >\r\n        <Sidebar\r\n          width={showSidebar && !screenWidth ? 'wide' : 'very thin'}\r\n          style={{ borderRight: '0.4px solid #ffffff1a', background: '#1b1c1d' }}\r\n          animation='push'\r\n          direction='left'\r\n          visible={true}\r\n        >\r\n          {!showSidebar || screenWidth ? <Menu inverted style={{ borderRadius: '0' }}>\r\n            <Menu.Item onClick={handleShowSidebar} style={{ width: '100%', justifyContent: 'center', display: 'flex', borderBottom: '1px solid #ffffff1a', height: '52px' }}>\r\n              <Icon name='filter' />\r\n            </Menu.Item>\r\n          </Menu>\r\n            : <Menu inverted vertical size='massive' style={{ borderRadius: '0' }}>\r\n              <Menu.Item\r\n                name='inbox'\r\n                // active={activeItem === 'inbox'}\r\n                onClick={handleShowSidebar}\r\n              >\r\n                Filter\r\n                <Icon name='angle left' />\r\n              </Menu.Item>\r\n              <Menu.Item>\r\n                <Input icon='search' placeholder='Search...' />\r\n              </Menu.Item>\r\n              <Menu.Item\r\n                name='inbox'\r\n              // active={activeItem === 'inbox'}\r\n              // onClick={this.handleItemClick}\r\n              >\r\n                <Label color='teal'>1</Label>\r\n                Inbox\r\n              </Menu.Item>\r\n\r\n              <Menu.Item\r\n                name='spam'\r\n              // active={activeItem === 'spam'}\r\n              // onClick={this.handleItemClick}\r\n              >\r\n                <Label>51</Label>\r\n                Spam\r\n              </Menu.Item>\r\n\r\n              <Menu.Item\r\n                name='updates'\r\n              // active={activeItem === 'updates'}\r\n              // onClick={this.handleItemClick}\r\n              >\r\n                <Label>1</Label>\r\n                Updates\r\n              </Menu.Item>\r\n            </Menu>}\r\n\r\n        </Sidebar>\r\n        <Sidebar.Pusher>\r\n          <Menu pointing inverted secondary size='massive' style={{ borderBottom: '1px solid #ffffff1a', borderRadius: '0' }}>\r\n            <Menu.Item\r\n              style={{ borderRadius: '0', }}\r\n              active={true}\r\n            >\r\n              Items\r\n            </Menu.Item>\r\n            <Menu.Item\r\n              style={{ borderRadius: '0', height: '52px' }}\r\n              active={false}\r\n            >\r\n              Activity\r\n            </Menu.Item>\r\n          </Menu>\r\n          <div style={{ padding: '8px' }}>\r\n            <CustomGrid style={{ width: showSidebar && !screenWidth ? 'calc(100vw - 350px)' : 'calc(100vw - 60px)' }}>\r\n              {nfts.map((e, i) => (\r\n                <Grid.Column mobile={8} tablet={5} largeScreen={4} computer={2}>\r\n                  <CardItem data={e} />\r\n                </Grid.Column>\r\n              ))}\r\n            </CustomGrid>\r\n          </div>\r\n        </Sidebar.Pusher>\r\n      </Sidebar.Pushable>\r\n    </Fragment>\r\n  )\r\n}\r\n\r\nexport default Expore"],"sourceRoot":""}